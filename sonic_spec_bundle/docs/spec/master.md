# Sonic Spec (Master)

> This is the canonical entry for GPTs and humans. Truth order:
> **1) This `/docs/spec` folder → 2) `api/openapi.yaml` → 3) `/docs/schemas/*.json` → 4) Code comments.**

## 0. TL;DR for GPTs
- **Purpose:** Sonic is a Python/React/FastAPI system for crypto derivatives trading and risk management.
- **Primary entrypoints:**
  - HTTP API (FastAPI): `api/main.py` (routers under `api/routers/*`)
  - Web UI (React): `web/src` (routes under `web/src/routes/*`)
  - Workers/Jobs (optional): `core/workers/*` or `scripts/*`
- **Do not:**
  - Invent endpoints not in `api/openapi.yaml`.
  - Bypass domain logic (`core/*`) by touching adapters directly.
- **Prefer:**
  - Pydantic models in `api/models/*` and `core/models/*`
  - Shared clients in `web/src/lib/api/*`
  - Existing workflows in `docs/spec/workflows.md`

## 1. Domain Glossary
See `docs/spec/domain_glossary.md`

## 2. Architecture at a Glance
See `docs/spec/architecture.md`

## 3. Codebase Map (Generated)
See `docs/spec/codebase_map.md` (generated by `scripts/spec_sync.py` or `scripts/update_spec.py`)

## 4. APIs
- OpenAPI: `api/openapi.yaml` (generated; authoritative endpoints)
- Auth scheme: Bearer JWT tokens via `Authorization: Bearer <token>`
- Error shape: `{ "error": { "code": "STRING", "message": "STRING" } }`

## 4a. API Docs (generated)
- Full index (auto-generated from OpenAPI): `docs/spec/api_index.md`
- Quick reference (auto-generated from OpenAPI): `docs/teaching_pack/04_api_quick.md`

## 5. Data Contracts
- JSON Schemas: `docs/schemas/*.json`
- Pydantic models: `api/models/*.py` (HTTP), `core/models/*.py` (domain)
- DB migrations: `infra/migrations/*` (if applicable)

## 6. Workflows
See `docs/spec/workflows.md` for end-to-end flows and invariants.

## 7. UI Contracts (React)
See `docs/spec/ui_contracts.md`

## 8. Conventions
See `docs/spec/conventions.md`

## 9. Non-Goals & Red Lines
See `docs/spec/non_goals.md`

## 10. Quickstart / Dev
- `cp .env.example .env` and fill values

**Regenerate specs (cross-platform):**
- Windows:
  ```bat
  python scripts\update_spec.py
